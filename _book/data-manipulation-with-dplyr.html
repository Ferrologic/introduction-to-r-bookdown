<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Data manipulation with dplyr | Introduction to R</title>
  <meta name="description" content="This book contains workshop material for 4 workshop held at tele2 during the autumn of 2019" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Data manipulation with dplyr | Introduction to R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book contains workshop material for 4 workshop held at tele2 during the autumn of 2019" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Data manipulation with dplyr | Introduction to R" />
  
  <meta name="twitter:description" content="This book contains workshop material for 4 workshop held at tele2 during the autumn of 2019" />
  

<meta name="author" content="Filip Wästberg" />


<meta name="date" content="2019-08-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="module-1-introduction-to-r.html">
<link rel="next" href="answers-to-excercises.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Tele2: Introduction to R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>2</b> Introduction to R</a></li>
<li class="chapter" data-level="3" data-path="module-1-introduction-to-r.html"><a href="module-1-introduction-to-r.html"><i class="fa fa-check"></i><b>3</b> Module 1 - introduction to R</a><ul>
<li class="chapter" data-level="3.1" data-path="module-1-introduction-to-r.html"><a href="module-1-introduction-to-r.html#missing-values"><i class="fa fa-check"></i><b>3.1</b> Missing values</a></li>
<li class="chapter" data-level="3.2" data-path="module-1-introduction-to-r.html"><a href="module-1-introduction-to-r.html#r-is-a-functional-programming-languange"><i class="fa fa-check"></i><b>3.2</b> R is a functional programming languange</a></li>
<li class="chapter" data-level="3.3" data-path="module-1-introduction-to-r.html"><a href="module-1-introduction-to-r.html#functions"><i class="fa fa-check"></i><b>3.3</b> Functions</a></li>
<li class="chapter" data-level="3.4" data-path="module-1-introduction-to-r.html"><a href="module-1-introduction-to-r.html#documentation"><i class="fa fa-check"></i><b>3.4</b> Documentation</a></li>
<li class="chapter" data-level="3.5" data-path="module-1-introduction-to-r.html"><a href="module-1-introduction-to-r.html#excercices"><i class="fa fa-check"></i><b>3.5</b> Excercices</a></li>
<li class="chapter" data-level="3.6" data-path="module-1-introduction-to-r.html"><a href="module-1-introduction-to-r.html#data.frame"><i class="fa fa-check"></i><b>3.6</b> data.frame</a></li>
<li class="chapter" data-level="3.7" data-path="module-1-introduction-to-r.html"><a href="module-1-introduction-to-r.html#packages"><i class="fa fa-check"></i><b>3.7</b> Packages</a></li>
<li class="chapter" data-level="3.8" data-path="module-1-introduction-to-r.html"><a href="module-1-introduction-to-r.html#excercise"><i class="fa fa-check"></i><b>3.8</b> Excercise</a></li>
<li class="chapter" data-level="3.9" data-path="module-1-introduction-to-r.html"><a href="module-1-introduction-to-r.html#tidyverse-and-friends"><i class="fa fa-check"></i><b>3.9</b> tidyverse and friends</a><ul>
<li class="chapter" data-level="3.9.1" data-path="module-1-introduction-to-r.html"><a href="module-1-introduction-to-r.html#workflow-in-r"><i class="fa fa-check"></i><b>3.9.1</b> Workflow in R</a></li>
<li class="chapter" data-level="3.9.2" data-path="module-1-introduction-to-r.html"><a href="module-1-introduction-to-r.html#writing-code-in-r"><i class="fa fa-check"></i><b>3.9.2</b> Writing code in R</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="module-1-introduction-to-r.html"><a href="module-1-introduction-to-r.html#when-saving-files"><i class="fa fa-check"></i><b>3.10</b> When saving files</a></li>
<li class="chapter" data-level="3.11" data-path="module-1-introduction-to-r.html"><a href="module-1-introduction-to-r.html#avoid-long-expressions"><i class="fa fa-check"></i><b>3.11</b> Avoid long expressions</a><ul>
<li class="chapter" data-level="3.11.1" data-path="module-1-introduction-to-r.html"><a href="module-1-introduction-to-r.html#rmarkdown"><i class="fa fa-check"></i><b>3.11.1</b> Rmarkdown</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html"><i class="fa fa-check"></i><b>4</b> Data manipulation with dplyr</a><ul>
<li class="chapter" data-level="4.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#excercise-1"><i class="fa fa-check"></i><b>4.1</b> Excercise</a></li>
<li class="chapter" data-level="4.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#filter"><i class="fa fa-check"></i><b>4.2</b> <code>filter()</code></a><ul>
<li class="chapter" data-level="4.2.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#operators"><i class="fa fa-check"></i><b>4.2.1</b> Operators</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#we-also-have-operators-for-checking-if-something-is-true"><i class="fa fa-check"></i><b>4.3</b> We also have operators for checking if something is TRUE</a><ul>
<li class="chapter" data-level="4.3.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#use-filter-to-find"><i class="fa fa-check"></i><b>4.3.1</b> Use filter to find…</a></li>
<li class="chapter" data-level="4.3.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#stringr"><i class="fa fa-check"></i><b>4.3.2</b> stringr</a></li>
<li class="chapter" data-level="4.3.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#stringr-in-filter"><i class="fa fa-check"></i><b>4.3.3</b> stringr in <code>filter()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#regex"><i class="fa fa-check"></i><b>4.4</b> Regex</a></li>
<li class="chapter" data-level="4.5" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#excercise-2"><i class="fa fa-check"></i><b>4.5</b> Excercise 2</a></li>
<li class="chapter" data-level="4.6" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#arrange"><i class="fa fa-check"></i><b>4.6</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="4.7" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#select"><i class="fa fa-check"></i><b>4.7</b> <code>select()</code></a><ul>
<li class="chapter" data-level="4.7.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#help-functions"><i class="fa fa-check"></i><b>4.7.1</b> Help functions</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#rename"><i class="fa fa-check"></i><b>4.8</b> rename()</a></li>
<li class="chapter" data-level="4.9" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#excercise-4"><i class="fa fa-check"></i><b>4.9</b> Excercise 4</a></li>
<li class="chapter" data-level="4.10" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#mutate"><i class="fa fa-check"></i><b>4.10</b> <code>mutate()</code></a><ul>
<li class="chapter" data-level="4.10.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#if_else"><i class="fa fa-check"></i><b>4.10.1</b> if_else()</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#excercise-5"><i class="fa fa-check"></i><b>4.11</b> Excercise 5</a></li>
<li class="chapter" data-level="4.12" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#dates"><i class="fa fa-check"></i><b>4.12</b> Dates</a></li>
<li class="chapter" data-level="4.13" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#excercise-6"><i class="fa fa-check"></i><b>4.13</b> Excercise 6</a></li>
<li class="chapter" data-level="4.14" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#summarise"><i class="fa fa-check"></i><b>4.14</b> <code>summarise()</code></a><ul>
<li class="chapter" data-level="4.14.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#group_by"><i class="fa fa-check"></i><b>4.14.1</b> group_by()</a></li>
</ul></li>
<li class="chapter" data-level="4.15" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#excercise-7"><i class="fa fa-check"></i><b>4.15</b> Excercise 7</a><ul>
<li class="chapter" data-level="4.15.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#more-expressions"><i class="fa fa-check"></i><b>4.15.1</b> More expressions</a></li>
</ul></li>
<li class="chapter" data-level="4.16" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#excercise-8"><i class="fa fa-check"></i><b>4.16</b> Excercise 8</a></li>
<li class="chapter" data-level="4.17" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#joins"><i class="fa fa-check"></i><b>4.17</b> Joins</a></li>
<li class="chapter" data-level="4.18" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#joins-som-venn"><i class="fa fa-check"></i><b>4.18</b> Joins som venn</a></li>
<li class="chapter" data-level="4.19" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#excercise-9"><i class="fa fa-check"></i><b>4.19</b> Excercise 9</a></li>
<li class="chapter" data-level="4.20" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#tidy-data"><i class="fa fa-check"></i><b>4.20</b> Tidy data</a></li>
<li class="chapter" data-level="4.21" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#untidy-data"><i class="fa fa-check"></i><b>4.21</b> Untidy data</a></li>
<li class="chapter" data-level="4.22" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#excercise-10"><i class="fa fa-check"></i><b>4.22</b> Excercise 10</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="answers-to-excercises.html"><a href="answers-to-excercises.html"><i class="fa fa-check"></i><b>5</b> Answers to excercises</a><ul>
<li class="chapter" data-level="5.1" data-path="answers-to-excercises.html"><a href="answers-to-excercises.html#excercise-11"><i class="fa fa-check"></i><b>5.1</b> Excercise</a></li>
<li class="chapter" data-level="5.2" data-path="answers-to-excercises.html"><a href="answers-to-excercises.html#excercise-12"><i class="fa fa-check"></i><b>5.2</b> Excercise</a></li>
<li class="chapter" data-level="5.3" data-path="answers-to-excercises.html"><a href="answers-to-excercises.html#excercise-13"><i class="fa fa-check"></i><b>5.3</b> Excercise</a></li>
<li class="chapter" data-level="5.4" data-path="answers-to-excercises.html"><a href="answers-to-excercises.html#excercise-1-1"><i class="fa fa-check"></i><b>5.4</b> Excercise 1</a></li>
<li class="chapter" data-level="5.5" data-path="answers-to-excercises.html"><a href="answers-to-excercises.html#excercise-2-1"><i class="fa fa-check"></i><b>5.5</b> Excercise 2</a></li>
<li class="chapter" data-level="5.6" data-path="answers-to-excercises.html"><a href="answers-to-excercises.html#excercise-3-1"><i class="fa fa-check"></i><b>5.6</b> Excercise 3</a></li>
<li class="chapter" data-level="5.7" data-path="answers-to-excercises.html"><a href="answers-to-excercises.html#excercise-4-1"><i class="fa fa-check"></i><b>5.7</b> Excercise 4</a></li>
<li class="chapter" data-level="5.8" data-path="answers-to-excercises.html"><a href="answers-to-excercises.html#excercise-5-1"><i class="fa fa-check"></i><b>5.8</b> Excercise 5</a></li>
<li class="chapter" data-level="5.9" data-path="answers-to-excercises.html"><a href="answers-to-excercises.html#excercise-6-1"><i class="fa fa-check"></i><b>5.9</b> Excercise 6</a></li>
<li class="chapter" data-level="5.10" data-path="answers-to-excercises.html"><a href="answers-to-excercises.html#excercise-7-1"><i class="fa fa-check"></i><b>5.10</b> Excercise 7</a></li>
<li class="chapter" data-level="5.11" data-path="answers-to-excercises.html"><a href="answers-to-excercises.html#excercise-8-1"><i class="fa fa-check"></i><b>5.11</b> Excercise 8</a></li>
<li class="chapter" data-level="5.12" data-path="answers-to-excercises.html"><a href="answers-to-excercises.html#excercise-9-1"><i class="fa fa-check"></i><b>5.12</b> Excercise 9</a></li>
<li class="chapter" data-level="5.13" data-path="answers-to-excercises.html"><a href="answers-to-excercises.html#excercise-10-1"><i class="fa fa-check"></i><b>5.13</b> Excercise 10</a></li>
<li class="chapter" data-level="5.14" data-path="answers-to-excercises.html"><a href="answers-to-excercises.html#extra"><i class="fa fa-check"></i><b>5.14</b> Extra</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="module-2-visualization.html"><a href="module-2-visualization.html"><i class="fa fa-check"></i><b>6</b> Module 2 - Visualization</a></li>
<li class="chapter" data-level="7" data-path="advanced-data-manipulation.html"><a href="advanced-data-manipulation.html"><i class="fa fa-check"></i><b>7</b> Advanced data manipulation</a></li>
<li class="chapter" data-level="8" data-path="machine-learning-with-sparklyr.html"><a href="machine-learning-with-sparklyr.html"><i class="fa fa-check"></i><b>8</b> Machine learning with sparklyr</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-manipulation-with-dplyr" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Data manipulation with dplyr</h1>
<p>dplyr is a package that makes data manipulation easy. It consists of five main verbs:</p>
<ul>
<li><p><code>filter()</code></p></li>
<li><p><code>arrange()</code></p></li>
<li><p><code>select()</code></p></li>
<li><p><code>mutate()</code></p></li>
<li><p><code>summarise()</code></p></li>
</ul>
<p>Other useful functions such as <code>glimpse()</code></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb40-3" data-line-number="3"><span class="kw">glimpse</span>(flights)</a></code></pre></div>
<pre><code>## Observations: 336,776
## Variables: 19
## $ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2…
## $ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 558,…
## $ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 600,…
## $ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, …
## $ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753…
## $ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745…
## $ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3,…
## $ carrier        &lt;chr&gt; &quot;UA&quot;, &quot;UA&quot;, &quot;AA&quot;, &quot;B6&quot;, &quot;DL&quot;, &quot;UA&quot;, &quot;B6&quot;, &quot;EV&quot;, &quot;…
## $ flight         &lt;int&gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, …
## $ tailnum        &lt;chr&gt; &quot;N14228&quot;, &quot;N24211&quot;, &quot;N619AA&quot;, &quot;N804JB&quot;, &quot;N668DN&quot;,…
## $ origin         &lt;chr&gt; &quot;EWR&quot;, &quot;LGA&quot;, &quot;JFK&quot;, &quot;JFK&quot;, &quot;LGA&quot;, &quot;EWR&quot;, &quot;EWR&quot;, …
## $ dest           &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;MIA&quot;, &quot;BQN&quot;, &quot;ATL&quot;, &quot;ORD&quot;, &quot;FLL&quot;, …
## $ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, …
## $ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944,…
## $ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6…
## $ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-0…</code></pre>
<div id="excercise-1" class="section level2">
<h2><span class="header-section-number">4.1</span> Excercise</h2>
<ul>
<li>Import the customer data into R using <code>read_csv(&quot;path&quot;)</code>, save it to a data.frame</li>
<li>Use <code>glimpse()</code> on it</li>
</ul>
</div>
<div id="filter" class="section level2">
<h2><span class="header-section-number">4.2</span> <code>filter()</code></h2>
<p><code>filter()</code> is a function that let’s you filter out rows that meet certain conditions.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 24,951 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     2     1      456            500        -4      652
##  2  2013     2     1      520            525        -5      816
##  3  2013     2     1      527            530        -3      837
##  4  2013     2     1      532            540        -8     1007
##  5  2013     2     1      540            540         0      859
##  6  2013     2     1      552            600        -8      714
##  7  2013     2     1      552            600        -8      919
##  8  2013     2     1      552            600        -8      655
##  9  2013     2     1      553            600        -7      833
## 10  2013     2     1      553            600        -7      821
## # … with 24,941 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>We can also use text:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw">filter</span>(flights, origin <span class="op">==</span><span class="st"> &quot;JFK&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 111,279 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      542            540         2      923
##  2  2013     1     1      544            545        -1     1004
##  3  2013     1     1      557            600        -3      838
##  4  2013     1     1      558            600        -2      849
##  5  2013     1     1      558            600        -2      853
##  6  2013     1     1      558            600        -2      924
##  7  2013     1     1      559            559         0      702
##  8  2013     1     1      606            610        -4      837
##  9  2013     1     1      611            600        11      945
## 10  2013     1     1      613            610         3      925
## # … with 111,269 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>And combine them:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="kw">filter</span>(flights, origin <span class="op">==</span><span class="st"> &quot;JFK&quot;</span> <span class="op">&amp;</span><span class="st"> </span>month <span class="op">==</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 8,421 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     2     1      532            540        -8     1007
##  2  2013     2     1      540            540         0      859
##  3  2013     2     1      552            600        -8      714
##  4  2013     2     1      554            601        -7      920
##  5  2013     2     1      555            600        -5      903
##  6  2013     2     1      558            600        -2      916
##  7  2013     2     1      559            600        -1      923
##  8  2013     2     1      602            600         2      655
##  9  2013     2     1      609            610        -1      902
## 10  2013     2     1      610            615        -5      905
## # … with 8,411 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>We can also filter out every row that meets a condition in a vector, for instance:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="kw">filter</span>(flights, origin <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;JFK&quot;</span>, <span class="st">&quot;LGA&quot;</span>)) </a></code></pre></div>
<pre><code>## # A tibble: 215,941 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      533            529         4      850
##  2  2013     1     1      542            540         2      923
##  3  2013     1     1      544            545        -1     1004
##  4  2013     1     1      554            600        -6      812
##  5  2013     1     1      557            600        -3      709
##  6  2013     1     1      557            600        -3      838
##  7  2013     1     1      558            600        -2      753
##  8  2013     1     1      558            600        -2      849
##  9  2013     1     1      558            600        -2      853
## 10  2013     1     1      558            600        -2      924
## # … with 215,931 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div id="operators" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Operators</h3>
<p>In R, as in any programming languange, there are a number of logical and relational operators.</p>
<p>In R these are:</p>
<pre><code>## # A tibble: 3 x 2
##   `Relation operators` `Symbol in R`
##   &lt;chr&gt;                &lt;chr&gt;        
## 1 &quot;och (and) &quot;         &amp;            
## 2 eller(or)            |            
## 3 icke(not)            !</code></pre>
<pre><code>## # A tibble: 7 x 2
##   `Logical Operators`   `Symbol in R`
##   &lt;chr&gt;                 &lt;chr&gt;        
## 1 equal                 ==           
## 2 not equal             !=           
## 3 larger than or equal  &gt;=           
## 4 smaller than or equal &lt;=           
## 5 larger than           &gt;            
## 6 smaller than          &lt;            
## 7 is in                 %in%</code></pre>
</div>
</div>
<div id="we-also-have-operators-for-checking-if-something-is-true" class="section level2">
<h2><span class="header-section-number">4.3</span> We also have operators for checking if something is TRUE</h2>
<ul>
<li>Instead of writing <code>x == TRUE</code> you should write <code>isTRUE(x)</code> and <code>!isTRUE(x)</code> if you want to check if something is <code>FALSE</code>.</li>
</ul>
<div id="use-filter-to-find" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Use filter to find…</h3>
<ol style="list-style-type: decimal">
<li><p>How many customers had a data-volume over 1000 in february 2019?</p></li>
<li><p>How many customers have been members longer than 2005</p></li>
<li><p>How many customers have a data-volume over 2000 in february and have a calculated revenue larger than 500 per month?</p></li>
<li><p>How many customers have a subscription with “Rörlig pris”?</p></li>
<li><p>Are there any customers that are missing an ID? I.e. is <code>NA</code>.</p></li>
</ol>
</div>
<div id="stringr" class="section level3">
<h3><span class="header-section-number">4.3.2</span> stringr</h3>
<ul>
<li>When working<code>filter()</code> it is common that we want to filter out certains parts of a string</li>
<li><code>stringr</code> is a great package for manipulating strings in R</li>
<li>Usually it’s functions starts with <code>str_...</code>, such as <code>str_detect()</code>.</li>
</ul>
<p>Here are some useful functions:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb52-2" data-line-number="2">frukt &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;banana&quot;</span>)</a>
<a class="sourceLine" id="cb52-3" data-line-number="3"><span class="kw">str_detect</span>(frukt, <span class="st">&quot;b&quot;</span>)</a></code></pre></div>
<pre><code>## [1] FALSE FALSE  TRUE</code></pre>
<p>Or <code>str_replace()</code></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="kw">str_replace</span>(frukt, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;ä&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;äpple&quot;  &quot;oränge&quot; &quot;bänana&quot;</code></pre>
<p>Or <code>str_remove()</code></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="kw">str_remove</span>(frukt, <span class="st">&quot;a&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;pple&quot;  &quot;ornge&quot; &quot;bnana&quot;</code></pre>
</div>
<div id="stringr-in-filter" class="section level3">
<h3><span class="header-section-number">4.3.3</span> stringr in <code>filter()</code></h3>
<p>We can use <code>stringr</code> in <code>filter()</code>:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="kw">filter</span>(flights, <span class="kw">str_detect</span>(carrier, <span class="st">&quot;U&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 79,201 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      554            558        -4      740
##  4  2013     1     1      558            600        -2      924
##  5  2013     1     1      558            600        -2      923
##  6  2013     1     1      559            600        -1      854
##  7  2013     1     1      607            607         0      858
##  8  2013     1     1      611            600        11      945
##  9  2013     1     1      622            630        -8     1017
## 10  2013     1     1      623            627        -4      933
## # … with 79,191 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<div id="regex" class="section level2">
<h2><span class="header-section-number">4.4</span> Regex</h2>
<ul>
<li>Specific string manipulation</li>
</ul>
<p>For example:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1">frukt</a></code></pre></div>
<pre><code>## [1] &quot;apple&quot;  &quot;orange&quot; &quot;banana&quot;</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1"><span class="kw">str_detect</span>(frukt, <span class="st">&quot;^b&quot;</span>)</a></code></pre></div>
<pre><code>## [1] FALSE FALSE  TRUE</code></pre>
<p>and</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1">frukt</a></code></pre></div>
<pre><code>## [1] &quot;apple&quot;  &quot;orange&quot; &quot;banana&quot;</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="kw">str_detect</span>(frukt, <span class="st">&quot;e$&quot;</span>)</a></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE</code></pre>
</div>
<div id="excercise-2" class="section level2">
<h2><span class="header-section-number">4.5</span> Excercise 2</h2>
<ol style="list-style-type: decimal">
<li>How many customers have a subscription with “Fast pris”?</li>
<li>How many customers have a subscription that is <em>not</em> “Bredband”?</li>
</ol>
</div>
<div id="arrange" class="section level2">
<h2><span class="header-section-number">4.6</span> <code>arrange()</code></h2>
<p><code>arrange()</code> is a verb for sorting data.frames.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="kw">arrange</span>(flights, dep_delay)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013    12     7     2040           2123       -43       40
##  2  2013     2     3     2022           2055       -33     2240
##  3  2013    11    10     1408           1440       -32     1549
##  4  2013     1    11     1900           1930       -30     2233
##  5  2013     1    29     1703           1730       -27     1947
##  6  2013     8     9      729            755       -26     1002
##  7  2013    10    23     1907           1932       -25     2143
##  8  2013     3    30     2030           2055       -25     2213
##  9  2013     3     2     1431           1455       -24     1601
## 10  2013     5     5      934            958       -24     1225
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>If you instead want to sort in descending order you can write like this:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(dep_delay))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242
##  2  2013     6    15     1432           1935      1137     1607
##  3  2013     1    10     1121           1635      1126     1239
##  4  2013     9    20     1139           1845      1014     1457
##  5  2013     7    22      845           1600      1005     1044
##  6  2013     4    10     1100           1900       960     1342
##  7  2013     3    17     2321            810       911      135
##  8  2013     6    27      959           1900       899     1236
##  9  2013     7    22     2257            759       898      121
## 10  2013    12     5      756           1700       896     1058
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div id="excercise-3" class="section level4">
<h4><span class="header-section-number">4.6.0.1</span> Excercise 3</h4>
<ol style="list-style-type: decimal">
<li>Which customer has been “active” longest? What is the date?</li>
<li>Which customer is most newly active?</li>
</ol>
</div>
</div>
<div id="select" class="section level2">
<h2><span class="header-section-number">4.7</span> <code>select()</code></h2>
<p><code>select()</code> is a verb for selecting columns in a data.frame.</p>
<p>You can choose columns by their name:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1"><span class="kw">select</span>(flights, year, month, day, origin)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##     year month   day origin
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; 
##  1  2013     1     1 EWR   
##  2  2013     1     1 LGA   
##  3  2013     1     1 JFK   
##  4  2013     1     1 JFK   
##  5  2013     1     1 LGA   
##  6  2013     1     1 EWR   
##  7  2013     1     1 EWR   
##  8  2013     1     1 LGA   
##  9  2013     1     1 JFK   
## 10  2013     1     1 LGA   
## # … with 336,766 more rows</code></pre>
<p>You can also choose columns based on their numerical order</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1"><span class="kw">select</span>(flights, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 5
##     year month   day dep_time sched_dep_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515
##  2  2013     1     1      533            529
##  3  2013     1     1      542            540
##  4  2013     1     1      544            545
##  5  2013     1     1      554            600
##  6  2013     1     1      554            558
##  7  2013     1     1      555            600
##  8  2013     1     1      557            600
##  9  2013     1     1      557            600
## 10  2013     1     1      558            600
## # … with 336,766 more rows</code></pre>
<p>You can select all the columns from column_a to column_d with<code>:</code> :</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="kw">select</span>(flights, year<span class="op">:</span>origin)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 13
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # … with 336,766 more rows, and 6 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;</code></pre>
<div id="help-functions" class="section level3">
<h3><span class="header-section-number">4.7.1</span> Help functions</h3>
<p>When you do data science you often want to move columns for different reasons. Not seldom you want to put one column first and the rest after. For this you can use the help function <code>everything()</code>:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="kw">select</span>(flights, origin, <span class="kw">everything</span>())</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##    origin  year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1 EWR     2013     1     1      517            515         2      830
##  2 LGA     2013     1     1      533            529         4      850
##  3 JFK     2013     1     1      542            540         2      923
##  4 JFK     2013     1     1      544            545        -1     1004
##  5 LGA     2013     1     1      554            600        -6      812
##  6 EWR     2013     1     1      554            558        -4      740
##  7 EWR     2013     1     1      555            600        -5      913
##  8 LGA     2013     1     1      557            600        -3      709
##  9 JFK     2013     1     1      557            600        -3      838
## 10 LGA     2013     1     1      558            600        -2      753
## # … with 336,766 more rows, and 11 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
<p>Apart from <code>eveything()</code> there are a number of other help functions:</p>
<ul>
<li><p>starts_with(“asd”)</p></li>
<li><p>ends_with(“air”)</p></li>
<li><p>contains(“flyg”)</p></li>
<li><p>matches(“asd”)</p></li>
<li><p>num_range(“flyg”, 1:10) matches flyg1, flyg2 … flyg10</p></li>
</ul>
<p>You can use these in the same way as <code>everything()</code>.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="kw">select</span>(flights, origin, <span class="kw">starts_with</span>(<span class="st">&quot;m&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##    origin month minute
##    &lt;chr&gt;  &lt;int&gt;  &lt;dbl&gt;
##  1 EWR        1     15
##  2 LGA        1     29
##  3 JFK        1     40
##  4 JFK        1     45
##  5 LGA        1      0
##  6 EWR        1     58
##  7 EWR        1      0
##  8 LGA        1      0
##  9 JFK        1      0
## 10 LGA        1      0
## # … with 336,766 more rows</code></pre>
</div>
</div>
<div id="rename" class="section level2">
<h2><span class="header-section-number">4.8</span> rename()</h2>
<p>To rename a variable you use <code>rename(data, new_variable = old_variable)</code></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1"><span class="kw">rename</span>(flights, å<span class="dt">r =</span> year)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##       år month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="excercise-4" class="section level2">
<h2><span class="header-section-number">4.9</span> Excercise 4</h2>
<ol style="list-style-type: decimal">
<li><p>Choose all columns that contain ”nm&quot;</p></li>
<li><p>Choose the column for customer ID and all columns that starts with ”tr_tot&quot;</p></li>
<li><p>Rename ”pc_priceplan_nm&quot; to ”price_plan&quot;</p></li>
</ol>
</div>
<div id="mutate" class="section level2">
<h2><span class="header-section-number">4.10</span> <code>mutate()</code></h2>
<ul>
<li><code>mutate()</code> is a verb for manipulating and creating new columns</li>
</ul>
<p>Below we create a new column with the mean of departure delay.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="kw">mutate</span>(flights, <span class="dt">mean_dep_delay =</span> <span class="kw">mean</span>(dep_delay))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # … with 336,766 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, mean_dep_delay &lt;dbl&gt;</code></pre>
<p>You can also use with simple mathematical operators <code>mutate()</code>:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="kw">mutate</span>(flights, <span class="dt">beer_time =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # … with 336,766 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, beer_time &lt;dbl&gt;</code></pre>
<p>There is a variant of mutate <code>mutate()</code> called<code>transmute()</code> that will return only the column that you have maniuplated.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1"><span class="kw">transmute</span>(flights, <span class="dt">beer_time =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 1
##    beer_time
##        &lt;dbl&gt;
##  1        -9
##  2       -16
##  3       -31
##  4        17
##  5        19
##  6       -16
##  7       -24
##  8        11
##  9         5
## 10       -10
## # … with 336,766 more rows</code></pre>
<p>In combination with <code>mutate()</code> you can use a variety of functions, some example of useful functions inside mutate is:</p>
<ul>
<li><p>rank(), min_rank(), dense_rank(), percent_rank() to rank</p></li>
<li><p>log(), log10() to take the log of a variable</p></li>
<li><p>cumsum(), cummean() for cummulative stats</p></li>
<li><p>row_number() if you need to create rownumbers</p></li>
<li><p>lead() and lag()</p></li>
</ul>
<p>For example we can lag departure delay and save it in a new variable.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="kw">transmute</span>(flights, <span class="dt">lag_dep_delay =</span> <span class="kw">lag</span>(dep_delay))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 1
##    lag_dep_delay
##            &lt;dbl&gt;
##  1            NA
##  2             2
##  3             4
##  4             2
##  5            -1
##  6            -6
##  7            -4
##  8            -5
##  9            -3
## 10            -3
## # … with 336,766 more rows</code></pre>
<div id="if_else" class="section level3">
<h3><span class="header-section-number">4.10.1</span> if_else()</h3>
<ul>
<li>A common task in Excel or any other programming languange is to compose <code>if else</code>-statements.</li>
<li>The best way to do this in R is with the function <code>if_else()</code></li>
</ul>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1"><span class="kw">transmute</span>(flights, fö<span class="dt">rsenad =</span> <span class="kw">if_else</span>(dep_delay  <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>, <span class="dt">true =</span> <span class="st">&quot;försenad&quot;</span>, <span class="dt">false =</span> <span class="st">&quot;ej försenad&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 1
##    försenad   
##    &lt;chr&gt;      
##  1 ej försenad
##  2 ej försenad
##  3 ej försenad
##  4 ej försenad
##  5 ej försenad
##  6 ej försenad
##  7 ej försenad
##  8 ej försenad
##  9 ej försenad
## 10 ej försenad
## # … with 336,766 more rows</code></pre>
<p>If you want to make multiple <code>if else</code>-statements, instead of making multiple <code>if else</code>-statements you can use the <code>case_when()</code> function:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="kw">transmute</span>(flights, fö<span class="dt">rsenad_kat =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb94-2" data-line-number="2">  dep_delay <span class="op">+</span><span class="st"> </span>arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">80</span> <span class="op">~</span><span class="st"> &quot;mycket_försenad&quot;</span>,</a>
<a class="sourceLine" id="cb94-3" data-line-number="3">  dep_delay <span class="op">+</span><span class="st"> </span>arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> &quot;ganska_försenad&quot;</span>,</a>
<a class="sourceLine" id="cb94-4" data-line-number="4">  dep_delay <span class="op">+</span><span class="st"> </span>arr_delay  <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> &quot;ej_försenad&quot;</span>,</a>
<a class="sourceLine" id="cb94-5" data-line-number="5">  <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;okänd&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 1
##    försenad_kat   
##    &lt;chr&gt;          
##  1 ganska_försenad
##  2 ganska_försenad
##  3 ganska_försenad
##  4 ej_försenad    
##  5 ej_försenad    
##  6 ganska_försenad
##  7 ganska_försenad
##  8 ej_försenad    
##  9 ej_försenad    
## 10 ganska_försenad
## # … with 336,766 more rows</code></pre>
</div>
</div>
<div id="excercise-5" class="section level2">
<h2><span class="header-section-number">4.11</span> Excercise 5</h2>
<ol style="list-style-type: decimal">
<li><p>Create a new variable that is the mean of the last 3 months of data consumption</p></li>
<li><p>Create a variable that takes the logarithm of your previously created column</p></li>
<li><p>Create a new variable that indicates if the priceplan is “Bredband” or not.</p></li>
<li><p>Create a new variable that groups priceplan in “Fast pris”, “Rörligt pris”, “Bredband” and “Annan” for everything that is not in any of the previous.</p></li>
</ol>
</div>
<div id="dates" class="section level2">
<h2><span class="header-section-number">4.12</span> Dates</h2>
<ul>
<li>Dates a information about time that we commonly use in analytics.</li>
<li>The easiest way to manipulate dates in R is with the package <code>lubridate</code>.</li>
</ul>
<p>In order to get todays date you can use the function <code>Sys.Date()</code>(that is built into R).</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="kw">Sys.Date</span>()</a></code></pre></div>
<pre><code>## [1] &quot;2019-08-23&quot;</code></pre>
<p>Say that you want to find the month, week or year of a date.</p>
<p>The package <code>lubridate</code> contains useful functions for this, such as <code>year()</code>, <code>month()</code> and <code>week</code>.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1"><span class="kw">library</span>(lubridate)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     date</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="kw">week</span>(<span class="kw">Sys.Date</span>())</a></code></pre></div>
<pre><code>## [1] 34</code></pre>
<p>In general you should define your date before passing it to a lubridate-function. In other words, you can’t just use a string (even though that sometimes work).</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1"><span class="kw">days_in_month</span>(<span class="st">&quot;2019-03-15&quot;</span>)</a></code></pre></div>
<pre><code>## Error in leap_year(x): unrecognized date format</code></pre>
<p>You can define you with with <code>as.Date()</code>, where you also can specify the format of the date.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1"><span class="kw">as.Date</span>(<span class="st">&quot;2018-03-15&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2018-03-15&quot;</code></pre>
<p>This is especially useful if your date is written in a non-standard way.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1"><span class="kw">as.Date</span>(<span class="st">&quot;03/18/15&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;%m/%y/%d&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2018-03-15&quot;</code></pre>
<p>Other functions that are useful in lubridate are <code>days_in_month</code>:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1"><span class="kw">days_in_month</span>(<span class="kw">as.Date</span>(<span class="st">&quot;2018-03-15&quot;</span>))</a></code></pre></div>
<pre><code>## Mar 
##  31</code></pre>
<p>And <code>floor_date()</code> if you, for example, want to find the first date in a month or a week,.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1"><span class="kw">floor_date</span>(<span class="kw">as.Date</span>(<span class="st">&quot;2018-03-15&quot;</span>), <span class="dt">unit =</span> <span class="st">&quot;month&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2018-03-01&quot;</code></pre>
</div>
<div id="excercise-6" class="section level2">
<h2><span class="header-section-number">4.13</span> Excercise 6</h2>
<ol style="list-style-type: decimal">
<li>Create a varible for month <code>lubridate::month(x)</code> of customer activation</li>
<li>Create a new varibale for <code>year</code> of customer activation</li>
<li>Create a new variable with the number of days in the month of activation</li>
</ol>
</div>
<div id="summarise" class="section level2">
<h2><span class="header-section-number">4.14</span> <code>summarise()</code></h2>
<p><code>summarise()</code> is a verb for summarizing data (you can also spell i <code>summarize()</code>).</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1"><span class="kw">summarise</span>(flights,</a>
<a class="sourceLine" id="cb113-2" data-line-number="2">          <span class="dt">mean_dist =</span> <span class="kw">mean</span>(distance, <span class="dt">na.rm =</span> T), </a>
<a class="sourceLine" id="cb113-3" data-line-number="3">          <span class="dt">median_dist =</span> <span class="kw">median</span>(distance, <span class="dt">na.rm =</span> T),</a>
<a class="sourceLine" id="cb113-4" data-line-number="4">          <span class="dt">sum_dist =</span> <span class="kw">sum</span>(distance, <span class="dt">na.rm =</span> T)</a>
<a class="sourceLine" id="cb113-5" data-line-number="5">)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   mean_dist median_dist  sum_dist
##       &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;
## 1     1040.         872 350217607</code></pre>
<div id="group_by" class="section level3">
<h3><span class="header-section-number">4.14.1</span> group_by()</h3>
<p>Below we create a new grouped data set grouped on <code>carrier</code> och <code>dest</code>.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1">carrier_dest_flights &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, carrier, dest)</a></code></pre></div>
<p>Every summarisation or mutation done on this new data-set will be done group wise.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1"><span class="kw">summarise</span>(carrier_dest_flights, <span class="dt">mean_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> T))</a></code></pre></div>
<pre><code>## # A tibble: 314 x 3
## # Groups:   carrier [16]
##    carrier dest  mean_dep_delay
##    &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
##  1 9E      ATL            0.965
##  2 9E      AUS           19    
##  3 9E      AVL           -2.6  
##  4 9E      BGR           34    
##  5 9E      BNA           19.1  
##  6 9E      BOS           14.8  
##  7 9E      BTV           -4.5  
##  8 9E      BUF           15.5  
##  9 9E      BWI           17.5  
## 10 9E      CAE           -3.67 
## # … with 304 more rows</code></pre>
</div>
</div>
<div id="excercise-7" class="section level2">
<h2><span class="header-section-number">4.15</span> Excercise 7</h2>
<ol style="list-style-type: decimal">
<li>What is the sum data volume during the last month? What’s the mean and median and what are the max and min values? You can use <code>max()</code> and <code>min()</code> to calculate maximum and minimum-values.</li>
</ol>
<div id="more-expressions" class="section level3">
<h3><span class="header-section-number">4.15.1</span> More expressions</h3>
<p>You can combine <code>dplyr</code>-verbs</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1"><span class="kw">summarise</span>(<span class="kw">group_by</span>(flights, carrier),</a>
<a class="sourceLine" id="cb118-2" data-line-number="2">          <span class="dt">mean_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> T))</a></code></pre></div>
<pre><code>## # A tibble: 16 x 2
##    carrier mean_dep_delay
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 9E               16.7 
##  2 AA                8.59
##  3 AS                5.80
##  4 B6               13.0 
##  5 DL                9.26
##  6 EV               20.0 
##  7 F9               20.2 
##  8 FL               18.7 
##  9 HA                4.90
## 10 MQ               10.6 
## 11 OO               12.6 
## 12 UA               12.1 
## 13 US                3.78
## 14 VX               12.9 
## 15 WN               17.7 
## 16 YV               19.0</code></pre>
<p>However, the more verbs you combine the harder it will be to read:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1"><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb120-2" data-line-number="2">  <span class="kw">group_by</span>(</a>
<a class="sourceLine" id="cb120-3" data-line-number="3">    <span class="kw">filter</span>(flights, dep_delay <span class="op">&lt;</span><span class="st"> </span><span class="dv">60</span>),</a>
<a class="sourceLine" id="cb120-4" data-line-number="4">    carrier),</a>
<a class="sourceLine" id="cb120-5" data-line-number="5">  <span class="dt">mean_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> T), <span class="dt">n_flights =</span> <span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 16 x 3
##    carrier mean_dep_delay n_flights
##    &lt;chr&gt;            &lt;dbl&gt;     &lt;int&gt;
##  1 9E               2.96      15425
##  2 AA               0.890     30059
##  3 AS              -0.719       673
##  4 B6               3.26      49514
##  5 DL               1.76      45062
##  6 EV               4.65      44372
##  7 F9               5.09        607
##  8 FL               4.72       2864
##  9 HA              -2.47        331
## 10 MQ               1.48      23126
## 11 OO              -2.88         25
## 12 UA               4.33      54080
## 13 US              -0.744     19094
## 14 VX               2.70       4766
## 15 WN               6.60      10999
## 16 YV               2.25        465</code></pre>
<div id="the-pipe" class="section level4">
<h4><span class="header-section-number">4.15.1.1</span> %&gt;% “the pipe”</h4>
<ul>
<li><code>%&gt;%</code> from the <code>magrittr</code>-package. <code>%&gt;%</code> is called “the pipe” and is pronounced “and then”.</li>
</ul>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(dep_delay <span class="op">&lt;</span><span class="st"> </span><span class="dv">60</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb122-5" data-line-number="5">    <span class="dt">mean_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> T),</a>
<a class="sourceLine" id="cb122-6" data-line-number="6">    <span class="dt">n_flights =</span> <span class="kw">n</span>()</a>
<a class="sourceLine" id="cb122-7" data-line-number="7">  )</a></code></pre></div>
<pre><code>## # A tibble: 16 x 3
##    carrier mean_dep_delay n_flights
##    &lt;chr&gt;            &lt;dbl&gt;     &lt;int&gt;
##  1 9E               2.96      15425
##  2 AA               0.890     30059
##  3 AS              -0.719       673
##  4 B6               3.26      49514
##  5 DL               1.76      45062
##  6 EV               4.65      44372
##  7 F9               5.09        607
##  8 FL               4.72       2864
##  9 HA              -2.47        331
## 10 MQ               1.48      23126
## 11 OO              -2.88         25
## 12 UA               4.33      54080
## 13 US              -0.744     19094
## 14 VX               2.70       4766
## 15 WN               6.60      10999
## 16 YV               2.25        465</code></pre>
</div>
</div>
</div>
<div id="excercise-8" class="section level2">
<h2><span class="header-section-number">4.16</span> Excercise 8</h2>
<p>Use <code>%&gt;%</code> and answer the following questions:</p>
<ol style="list-style-type: decimal">
<li><p>Which CPE type is most common?</p></li>
<li><p>Which priceplan has the highest mean data volume (for febraury 2019)?</p></li>
<li><p>Calculate the mean of data volume for the year that the customer was created. Which year has the highest mean?</p></li>
</ol>
</div>
<div id="joins" class="section level2">
<h2><span class="header-section-number">4.17</span> Joins</h2>
<p>To join data frames is an essential part of data manipulation, to do that we use <code>dplyr</code>’s different join functions:</p>
<ul>
<li><code>left_join()</code></li>
<li><code>right_join()</code></li>
<li><code>full_join()</code></li>
<li><code>inner_join()</code></li>
<li><code>semi_join()</code></li>
<li><code>anti_join()</code></li>
</ul>
</div>
<div id="joins-som-venn" class="section level2">
<h2><span class="header-section-number">4.18</span> Joins som venn</h2>
<p><img src="images/join-venn.png" width="551" /></p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(year<span class="op">:</span>day, hour, origin, dest, tailnum, carrier) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-3" data-line-number="3"><span class="st">  </span><span class="kw">left_join</span>(airlines, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;carrier&quot;</span> =<span class="st"> &quot;carrier&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 9
##     year month   day  hour origin dest  tailnum carrier name               
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;              
##  1  2013     1     1     5 EWR    IAH   N14228  UA      United Air Lines I…
##  2  2013     1     1     5 LGA    IAH   N24211  UA      United Air Lines I…
##  3  2013     1     1     5 JFK    MIA   N619AA  AA      American Airlines …
##  4  2013     1     1     5 JFK    BQN   N804JB  B6      JetBlue Airways    
##  5  2013     1     1     6 LGA    ATL   N668DN  DL      Delta Air Lines In…
##  6  2013     1     1     5 EWR    ORD   N39463  UA      United Air Lines I…
##  7  2013     1     1     6 EWR    FLL   N516JB  B6      JetBlue Airways    
##  8  2013     1     1     6 LGA    IAD   N829AS  EV      ExpressJet Airline…
##  9  2013     1     1     6 JFK    MCO   N593JB  B6      JetBlue Airways    
## 10  2013     1     1     6 LGA    ORD   N3ALAA  AA      American Airlines …
## # … with 336,766 more rows</code></pre>
</div>
<div id="excercise-9" class="section level2">
<h2><span class="header-section-number">4.19</span> Excercise 9</h2>
<ul>
<li>Left join your data with <code>tele2-kunder-transaktioner.csv</code> on <code>custid</code>.</li>
</ul>
</div>
<div id="tidy-data" class="section level2">
<h2><span class="header-section-number">4.20</span> Tidy data</h2>
<ul>
<li><code>tidy</code> data is when every observation is a row and every variable is a column.</li>
</ul>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1"><span class="kw">library</span>(gapminder)</a>
<a class="sourceLine" id="cb126-2" data-line-number="2">gapminder</a></code></pre></div>
<pre><code>## # A tibble: 1,704 x 6
##    country     continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.
##  2 Afghanistan Asia       1957    30.3  9240934      821.
##  3 Afghanistan Asia       1962    32.0 10267083      853.
##  4 Afghanistan Asia       1967    34.0 11537966      836.
##  5 Afghanistan Asia       1972    36.1 13079460      740.
##  6 Afghanistan Asia       1977    38.4 14880372      786.
##  7 Afghanistan Asia       1982    39.9 12881816      978.
##  8 Afghanistan Asia       1987    40.8 13867957      852.
##  9 Afghanistan Asia       1992    41.7 16317921      649.
## 10 Afghanistan Asia       1997    41.8 22227415      635.
## # … with 1,694 more rows</code></pre>
</div>
<div id="untidy-data" class="section level2">
<h2><span class="header-section-number">4.21</span> Untidy data</h2>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1"><span class="kw">library</span>(readxl)</a>
<a class="sourceLine" id="cb128-2" data-line-number="2">gapminder_untidy &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;data/life_expectancy_at_birth.xlsx&quot;</span>)</a>
<a class="sourceLine" id="cb128-3" data-line-number="3">gapminder_untidy </a></code></pre></div>
<pre><code>## # A tibble: 260 x 218
##    `Life expectanc… `1800` `1801` `1802` `1803` `1804` `1805` `1806` `1807`
##    &lt;chr&gt;             &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 Abkhazia           NA     NA     NA     NA     NA     NA     NA     NA  
##  2 Afghanistan        28.2   28.2   28.2   28.2   28.2   28.2   28.2   28.1
##  3 Akrotiri and Dh…   NA     NA     NA     NA     NA     NA     NA     NA  
##  4 Albania            35.4   35.4   35.4   35.4   35.4   35.4   35.4   35.4
##  5 Algeria            28.8   28.8   28.8   28.8   28.8   28.8   28.8   28.8
##  6 American Samoa     NA     NA     NA     NA     NA     NA     NA     NA  
##  7 Andorra            NA     NA     NA     NA     NA     NA     NA     NA  
##  8 Angola             27.0   27.0   27.0   27.0   27.0   27.0   27.0   27.0
##  9 Anguilla           NA     NA     NA     NA     NA     NA     NA     NA  
## 10 Antigua and Bar…   33.5   33.5   33.5   33.5   33.5   33.5   33.5   33.5
## # … with 250 more rows, and 209 more variables: `1808` &lt;dbl&gt;,
## #   `1809` &lt;dbl&gt;, `1810` &lt;dbl&gt;, `1811` &lt;dbl&gt;, `1812` &lt;dbl&gt;, `1813` &lt;dbl&gt;,
## #   `1814` &lt;dbl&gt;, `1815` &lt;dbl&gt;, `1816` &lt;dbl&gt;, `1817` &lt;dbl&gt;, `1818` &lt;dbl&gt;,
## #   `1819` &lt;dbl&gt;, `1820` &lt;dbl&gt;, `1821` &lt;dbl&gt;, `1822` &lt;dbl&gt;, `1823` &lt;dbl&gt;,
## #   `1824` &lt;dbl&gt;, `1825` &lt;dbl&gt;, `1826` &lt;dbl&gt;, `1827` &lt;dbl&gt;, `1828` &lt;dbl&gt;,
## #   `1829` &lt;dbl&gt;, `1830` &lt;dbl&gt;, `1831` &lt;dbl&gt;, `1832` &lt;dbl&gt;, `1833` &lt;dbl&gt;,
## #   `1834` &lt;dbl&gt;, `1835` &lt;dbl&gt;, `1836` &lt;dbl&gt;, `1837` &lt;dbl&gt;, `1838` &lt;dbl&gt;,
## #   `1839` &lt;dbl&gt;, `1840` &lt;dbl&gt;, `1841` &lt;dbl&gt;, `1842` &lt;dbl&gt;, `1843` &lt;dbl&gt;,
## #   `1844` &lt;dbl&gt;, `1845` &lt;dbl&gt;, `1846` &lt;dbl&gt;, `1847` &lt;dbl&gt;, `1848` &lt;dbl&gt;,
## #   `1849` &lt;dbl&gt;, `1850` &lt;dbl&gt;, `1851` &lt;dbl&gt;, `1852` &lt;dbl&gt;, `1853` &lt;dbl&gt;,
## #   `1854` &lt;dbl&gt;, `1855` &lt;dbl&gt;, `1856` &lt;dbl&gt;, `1857` &lt;dbl&gt;, `1858` &lt;dbl&gt;,
## #   `1859` &lt;dbl&gt;, `1860` &lt;dbl&gt;, `1861` &lt;dbl&gt;, `1862` &lt;dbl&gt;, `1863` &lt;dbl&gt;,
## #   `1864` &lt;dbl&gt;, `1865` &lt;dbl&gt;, `1866` &lt;dbl&gt;, `1867` &lt;dbl&gt;, `1868` &lt;dbl&gt;,
## #   `1869` &lt;dbl&gt;, `1870` &lt;dbl&gt;, `1871` &lt;dbl&gt;, `1872` &lt;dbl&gt;, `1873` &lt;dbl&gt;,
## #   `1874` &lt;dbl&gt;, `1875` &lt;dbl&gt;, `1876` &lt;dbl&gt;, `1877` &lt;dbl&gt;, `1878` &lt;dbl&gt;,
## #   `1879` &lt;dbl&gt;, `1880` &lt;dbl&gt;, `1881` &lt;dbl&gt;, `1882` &lt;dbl&gt;, `1883` &lt;dbl&gt;,
## #   `1884` &lt;dbl&gt;, `1885` &lt;dbl&gt;, `1886` &lt;dbl&gt;, `1887` &lt;dbl&gt;, `1888` &lt;dbl&gt;,
## #   `1889` &lt;dbl&gt;, `1890` &lt;dbl&gt;, `1891` &lt;dbl&gt;, `1892` &lt;dbl&gt;, `1893` &lt;dbl&gt;,
## #   `1894` &lt;dbl&gt;, `1895` &lt;dbl&gt;, `1896` &lt;dbl&gt;, `1897` &lt;dbl&gt;, `1898` &lt;dbl&gt;,
## #   `1899` &lt;dbl&gt;, `1900` &lt;dbl&gt;, `1901` &lt;dbl&gt;, `1902` &lt;dbl&gt;, `1903` &lt;dbl&gt;,
## #   `1904` &lt;dbl&gt;, `1905` &lt;dbl&gt;, `1906` &lt;dbl&gt;, `1907` &lt;dbl&gt;, …</code></pre>
<p>We want to gather the columns</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1">data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>(key, value, columns_to_gather)</a></code></pre></div>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1">gapminder_untidy <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb131-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>(<span class="dt">key =</span> year, <span class="dt">value =</span> life_expectancy, <span class="op">-</span><span class="st">`</span><span class="dt">Life expectancy</span><span class="st">`</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-3" data-line-number="3"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">land =</span> <span class="st">`</span><span class="dt">Life expectancy</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb131-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">life_expectancy =</span> <span class="kw">as.numeric</span>(life_expectancy))</a></code></pre></div>
<pre><code>## # A tibble: 56,420 x 3
##    land                  year  life_expectancy
##    &lt;chr&gt;                 &lt;chr&gt;           &lt;dbl&gt;
##  1 Abkhazia              1800             NA  
##  2 Afghanistan           1800             28.2
##  3 Akrotiri and Dhekelia 1800             NA  
##  4 Albania               1800             35.4
##  5 Algeria               1800             28.8
##  6 American Samoa        1800             NA  
##  7 Andorra               1800             NA  
##  8 Angola                1800             27.0
##  9 Anguilla              1800             NA  
## 10 Antigua and Barbuda   1800             33.5
## # … with 56,410 more rows</code></pre>
<ul>
<li><code>spread()</code> does the opposite.</li>
</ul>
</div>
<div id="excercise-10" class="section level2">
<h2><span class="header-section-number">4.22</span> Excercise 10</h2>
<ul>
<li><p>In your data set you have 12 columns for data volume consumption per month, <code>tr_tot_data_vol_all_netw_1:tr_tot_data_vol_all_netw_12</code></p></li>
<li><p>Every column represent a month and you want to calculate the mean of data volume consumption over time.</p></li>
<li><p>The columns represent a month</p></li>
<li><p>The first column <code>tr_tot_data_vol_all_netw_1</code> is the latest month, i.e. “2019-04-30”</p></li>
<li><p>Create a vector with all the month dates corresponding to the columns.</p></li>
<li><p>R function called <code>seq()</code></p></li>
</ul>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1">new_cols &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2018-05-30&quot;</span>), <span class="dt">by =</span> <span class="st">&quot;month&quot;</span>, <span class="dt">length.out =</span> <span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb133-2" data-line-number="2"><span class="st">  </span><span class="kw">as.character</span>()</a>
<a class="sourceLine" id="cb133-3" data-line-number="3"></a>
<a class="sourceLine" id="cb133-4" data-line-number="4">new_cols</a></code></pre></div>
<pre><code>##  [1] &quot;2018-05-30&quot; &quot;2018-06-30&quot; &quot;2018-07-30&quot; &quot;2018-08-30&quot; &quot;2018-09-30&quot;
##  [6] &quot;2018-10-30&quot; &quot;2018-11-30&quot; &quot;2018-12-30&quot; &quot;2019-01-30&quot; &quot;2019-03-02&quot;
## [11] &quot;2019-03-30&quot; &quot;2019-04-30&quot;</code></pre>
<p>Rename every column by it’s date.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1">kunder <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb135-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(cust_id, source_date, pc_priceplan_nm, tr_tot_data_vol_all_netw_<span class="dv">1</span><span class="op">:</span>tr_tot_data_vol_all_netw_<span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb135-3" data-line-number="3"><span class="st">  </span><span class="kw">rename_at</span>(<span class="kw">vars</span>(tr_tot_data_vol_all_netw_<span class="dv">1</span><span class="op">:</span>tr_tot_data_vol_all_netw_<span class="dv">12</span>), <span class="op">~</span>new_cols)</a></code></pre></div>
<ul>
<li>Fill in the <code>sort(decreasing = )</code> to <code>TRUE</code></li>
<li>Gather the data into two new columns called <code>data_month</code> and <code>data_volume</code></li>
<li>Turn <code>data_month</code> into a date-column</li>
</ul>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" data-line-number="1">new_cols &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2018-05-30&quot;</span>), <span class="dt">by =</span> <span class="st">&quot;month&quot;</span>, <span class="dt">length.out =</span> <span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-2" data-line-number="2"><span class="st">  </span><span class="kw">sort</span>(<span class="dt">decreasing =</span> ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-3" data-line-number="3"><span class="st">  </span><span class="kw">as.character</span>() </a>
<a class="sourceLine" id="cb136-4" data-line-number="4"></a>
<a class="sourceLine" id="cb136-5" data-line-number="5">kunder_tidy_month &lt;-<span class="st"> </span>kunder <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(cust_id, source_date, pc_priceplan_nm, tr_tot_data_vol_all_netw_<span class="dv">1</span><span class="op">:</span>tr_tot_data_vol_all_netw_<span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-7" data-line-number="7"><span class="st">  </span><span class="kw">rename_at</span>(<span class="kw">vars</span>(tr_tot_data_vol_all_netw_<span class="dv">1</span><span class="op">:</span>tr_tot_data_vol_all_netw_<span class="dv">12</span>), <span class="op">~</span>new_cols) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-8" data-line-number="8"><span class="st">  </span><span class="kw">gather</span>(... , ... , <span class="st">`</span><span class="dt">2018-05-30</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2019-04-30</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">data_month =</span> <span class="kw">as.Date</span>(data_month))</a></code></pre></div>
<ul>
<li>Calculate the mean value per priceplan and month</li>
</ul>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1">mean_volume_sum &lt;-<span class="st"> </span>kunder_tidy_month <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb137-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(pc_priceplan_nm, data_month) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb137-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_volume =</span> <span class="kw">mean</span>(data_volume, <span class="dt">na.rm =</span> T))</a>
<a class="sourceLine" id="cb137-4" data-line-number="4"></a>
<a class="sourceLine" id="cb137-5" data-line-number="5">mean_volume_sum </a></code></pre></div>
<p>Execute the code to visualize:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mean_volume_sum, </a>
<a class="sourceLine" id="cb138-2" data-line-number="2">         <span class="kw">aes</span>(<span class="dt">x =</span> data_month, <span class="dt">y =</span> mean_volume, <span class="dt">color =</span> pc_priceplan_nm)) <span class="op">+</span></a>
<a class="sourceLine" id="cb138-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb138-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_color_discrete</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb138-5" data-line-number="5"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1">widget &lt;-<span class="st"> </span>plotly<span class="op">::</span><span class="kw">ggplotly</span>(p)</a>
<a class="sourceLine" id="cb139-2" data-line-number="2">htmlwidgets<span class="op">::</span><span class="kw">saveWidget</span>(widget, <span class="st">&quot;plotly_ex.html&quot;</span>)</a></code></pre></div>
<p>&lt;iframe src=“plotly_ex.html” width = “900px”, height = “600px” frameBorder=“0”&gt;</iframe></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="module-1-introduction-to-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="answers-to-excercises.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["introduction-to-r-tele2.pdf", "introduction-to-r-tele2.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
